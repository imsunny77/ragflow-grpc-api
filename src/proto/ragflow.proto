syntax = "proto3";

package ragflow;

// Basic message types
message StatusResponse {
  bool status = 1;
  string message = 2;
  optional string data = 3;
}

// Dataset/Knowledge Base messages
message CreateKnowledgeBaseRequest {
  string name = 1;
  optional string description = 2;
}

message CreateKnowledgeBaseResponse {
  bool status = 1;
  string message = 2;
  optional string kb_id = 3;
}

message ListDatasetsRequest {
  optional int32 page = 1;
  optional int32 page_size = 2;
  optional string orderby = 3;
  optional bool desc = 4;
  optional string name = 5;
  optional string id = 6;
}

message Dataset {
  string id = 1;
  string name = 2;
  optional string description = 3;
  optional string avatar = 4;
  string embedding_model = 5;
  string permission = 6;
  string chunk_method = 7;
  int32 chunk_count = 8;
  int32 document_count = 9;
  string create_date = 10;
  string update_date = 11;
}

message ListDatasetsResponse {
  bool status = 1;
  string message = 2;
  repeated Dataset datasets = 3;
}

message UpdateDatasetRequest {
  string dataset_id = 1;
  optional string name = 2;
  optional string description = 3;
  optional string embedding_model = 4;
  optional string permission = 5;
  optional string chunk_method = 6;
}

message DeleteDatasetsRequest {
  repeated string ids = 1; // if empty, deletes all datasets
}

// Document Management messages
message Document {
  string id = 1;
  string name = 2;
  string dataset_id = 3;
  int32 size = 4;
  string type = 5;
  string chunk_method = 6;
  int32 chunk_count = 7;
  string status = 8;
  string create_date = 9;
  string update_date = 10;
  optional string thumbnail = 11;
}

message ListDocumentsRequest {
  string dataset_id = 1;
  optional int32 page = 2;
  optional int32 page_size = 3;
  optional string orderby = 4;
  optional bool desc = 5;
  optional string keywords = 6;
  optional string id = 7;
  optional string name = 8;
}

message ListDocumentsResponse {
  bool status = 1;
  string message = 2;
  repeated Document documents = 3;
  optional int32 total = 4;
}

message UpdateDocumentRequest {
  string dataset_id = 1;
  string document_id = 2;
  optional string name = 3;
  optional string chunk_method = 4;
  // parser_config as JSON string for simplicity
  optional string parser_config = 5;
}

message DownloadDocumentRequest {
  string dataset_id = 1;
  string document_id = 2;
}

message DownloadDocumentResponse {
  bool status = 1;
  string message = 2;
  optional bytes file_data = 3;
  optional string filename = 4;
}

message DeleteDocumentsRequest {
  string dataset_id = 1;
  repeated string ids = 2; // if empty, deletes all documents in dataset
}

message ParseDocumentsRequest {
  string dataset_id = 1;
  repeated string document_ids = 2;
}

message UploadDocumentRequest {
  string kb_id = 1;
  bytes file_data = 2;
  string filename = 3;
}

// Chat messages
message ChatRequest {
  string kb_id = 1;
  string question = 2;
}

message ChatResponse {
  bool status = 1;
  string message = 2;
  optional string answer = 3;
}

// gRPC Service Definition
service RagServices {
  // Dataset Management
  rpc CreateKnowledgeBase(CreateKnowledgeBaseRequest) returns (CreateKnowledgeBaseResponse);
  rpc ListDatasets(ListDatasetsRequest) returns (ListDatasetsResponse);
  rpc UpdateDataset(UpdateDatasetRequest) returns (StatusResponse);
  rpc DeleteDatasets(DeleteDatasetsRequest) returns (StatusResponse);

  // Document Management
  rpc UploadDocument(UploadDocumentRequest) returns (StatusResponse);
  rpc ListDocuments(ListDocumentsRequest) returns (ListDocumentsResponse);
  rpc UpdateDocument(UpdateDocumentRequest) returns (StatusResponse);
  rpc DownloadDocument(DownloadDocumentRequest) returns (DownloadDocumentResponse);
  rpc DeleteDocuments(DeleteDocumentsRequest) returns (StatusResponse);
  rpc ParseDocuments(ParseDocumentsRequest) returns (StatusResponse);

  // Chat
  rpc Chat(ChatRequest) returns (ChatResponse);
}
